{{ define "pages/sales/quotation_form.html" }}
{{ template "layouts/base.html" . }}
{{ end }}

{{ define "title" }}{{ if .Quotation }}Edit Quotation{{ else }}New Quotation{{ end }}{{ end }}

{{ define "content" }}
<div class="quotation-form-wrapper">
    <header>
        <h1>{{ if .Quotation }}Edit Quotation {{ .Quotation.DocNumber }}{{ else }}New Quotation{{ end }}</h1>
        <p>{{ if .Quotation }}Update quotation details and line items{{ else }}Create a new sales quotation{{ end }}</p>
    </header>

    {{ if .Errors.general }}
    <article class="error">
        <p><strong>Error</p>:</strong> {{ .Errors.general }}</p>
    </article>
    {{ end }}

    <form method="post"
        action="{{ if .Quotation }}/sales/quotations/{{ .Quotation.ID }}/edit{{ else }}/sales/quotations{{ end }}">
        <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">

        <!-- Header Information -->
        <section>
            <h2>Quotation Information</h2>
            <div class="grid">
                <div>
                    <label for="customer_id">Customer <span class="required">*</span></label>
                    <select name="customer_id" id="customer_id" required {{ if .Quotation }}disabled{{ end }}>
                        <option value="">Select customer...</option>
                        {{ range .Customers }}
                        <option value="{{ .ID }}" {{ if $.Quotation }}{{ if eq $.Quotation.CustomerID .ID }}selected{{
                            end }}{{ end }}>
                            {{ .Code }} - {{ .Name }}
                        </option>
                        {{ end }}
                    </select>
                    {{ if .Quotation }}
                    <input type="hidden" name="customer_id" value="{{ .Quotation.CustomerID }}">
                    {{ end }}
                </div>
                <div>
                    <label for="currency">Currency <span class="required">*</span></label>
                    <select name="currency" id="currency" required>
                        <option value="IDR" {{ if .Quotation }}{{ if eq .Quotation.Currency "IDR" }}selected{{ end }}{{
                            else }}selected{{ end }}>IDR</option>
                        <option value="USD" {{ if .Quotation }}{{ if eq .Quotation.Currency "USD" }}selected{{ end }}{{
                            end }}>USD</option>
                        <option value="EUR" {{ if .Quotation }}{{ if eq .Quotation.Currency "EUR" }}selected{{ end }}{{
                            end }}>EUR</option>
                    </select>
                </div>
            </div>

            <div class="grid">
                <div>
                    <label for="quote_date">Quote Date <span class="required">*</span></label>
                    <input type="date" name="quote_date" id="quote_date" required
                        value="{{ if .Quotation }}{{ .Quotation.QuoteDate.Format " 2006-01-02" }}{{ end }}">
                </div>
                <div>
                    <label for="valid_until">Valid Until <span class="required">*</span></label>
                    <input type="date" name="valid_until" id="valid_until" required
                        value="{{ if .Quotation }}{{ .Quotation.ValidUntil.Format " 2006-01-02" }}{{ end }}">
                </div>
            </div>

            <div>
                <label for="notes">Notes</label>
                <textarea name="notes" id="notes" rows="3"
                    placeholder="Additional notes or terms">{{ if .Quotation }}{{ .Quotation.Notes }}{{ end }}</textarea>
            </div>
        </section>

        <!-- Line Items -->
        <section>
            <h2>Line Items</h2>
            <p><small>Add products and quantities to this quotation</p></small></p>

            <div id="line-items-container">
                {{ if .Quotation }}
                {{ range $index, $line := .Quotation.Lines }}
                <div class="line-item" data-index="{{ $index }}">
                    <div class="grid">
                        <div>
                            <label for="product_id_{{ $index }}">Product ID <span class="required">*</span></label>
                            <input type="number" name="product_id" id="product_id_{{ $index }}" required min="1"
                                value="{{ $line.ProductID }}">
                        </div>
                        <div>
                            <label for="quantity_{{ $index }}">Quantity <span class="required">*</span></label>
                            <input type="number" name="quantity" id="quantity_{{ $index }}" required min="0.01"
                                step="0.01" value="{{ printf " %.2f" $line.Quantity }}">
                        </div>
                        <div>
                            <label for="uom_{{ $index }}">UOM <span class="required">*</span></label>
                            <input type="text" name="uom" id="uom_{{ $index }}" required value="{{ $line.UOM }}"
                                placeholder="PCS">
                        </div>
                    </div>
                    <div class="grid">
                        <div>
                            <label for="unit_price_{{ $index }}">Unit Price <span class="required">*</span></label>
                            <input type="number" name="unit_price" id="unit_price_{{ $index }}" required min="0"
                                step="0.01" value="{{ printf " %.2f" $line.UnitPrice }}">
                        </div>
                        <div>
                            <label for="discount_percent_{{ $index }}">Discount %</label>
                            <input type="number" name="discount_percent" id="discount_percent_{{ $index }}" min="0"
                                max="100" step="0.01" value="{{ printf " %.2f" $line.DiscountPercent }}">
                        </div>
                        <div>
                            <label for="tax_percent_{{ $index }}">Tax %</label>
                            <input type="number" name="tax_percent" id="tax_percent_{{ $index }}" min="0" max="100"
                                step="0.01" value="{{ printf " %.2f" $line.TaxPercent }}">
                        </div>
                        <div class="flex items-end">
                            <button type="button" class="btn btn--ghost btn--sm"
                                data-action="remove-line">Remove</button>
                        </div>
                    </div>
                </div>
                {{ end }}
                {{ else }}
                <div class="line-item" data-index="0">
                    <div class="grid">
                        <div>
                            <label for="product_id_0">Product ID <span class="required">*</span></label>
                            <input type="number" name="product_id" id="product_id_0" required min="1">
                        </div>
                        <div>
                            <label for="quantity_0">Quantity <span class="required">*</span></label>
                            <input type="number" name="quantity" id="quantity_0" required min="0.01" step="0.01"
                                value="1.00">
                        </div>
                        <div>
                            <label for="uom_0">UOM <span class="required">*</span></label>
                            <input type="text" name="uom" id="uom_0" required value="PCS">
                        </div>
                    </div>
                    <div class="grid">
                        <div>
                            <label for="unit_price_0">Unit Price <span class="required">*</span></label>
                            <input type="number" name="unit_price" id="unit_price_0" required min="0" step="0.01"
                                value="0.00">
                        </div>
                        <div>
                            <label for="discount_percent_0">Discount %</label>
                            <input type="number" name="discount_percent" id="discount_percent_0" min="0" max="100"
                                step="0.01" value="0.00">
                        </div>
                        <div>
                            <label for="tax_percent_0">Tax %</label>
                            <input type="number" name="tax_percent" id="tax_percent_0" min="0" max="100" step="0.01"
                                value="11.00">
                        </div>
                        <div class="flex items-end">
                            <button type="button" class="btn btn--ghost btn--sm"
                                data-action="remove-line">Remove</button>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>

            <button type="button" class="btn btn--secondary" data-action="add-line">+ Add Line Item</button>
        </section>

        <!-- Actions -->
        <section>
            <div role="group">
                <a href="{{ if .Quotation }}/sales/quotations/{{ .Quotation.ID }}{{ else }}/sales/quotations{{ end }}"
                    role="button" class="secondary">Cancel</a>
                <button type="submit">{{ if .Quotation }}Update Quotation{{ else }}Create Quotation{{ end }}</button>
            </div>
        </section>
    </form>
</div>
{{ end }}
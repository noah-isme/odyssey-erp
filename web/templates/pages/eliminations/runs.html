{{ define "title" }}Elimination Runs{{ end }}

{{ define "content" }}
<header class="page-header">
    <div class="page-header__content">
        <h1>Elimination Runs</h1>
        <p class="text-secondary">Execute and monitor elimination simulations and runs.</p>
    </div>
</header>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <section class="card col-span-1">
        <header class="card__header">
            <h2 class="card__title">Start New Run</h2>
        </header>
        <div class="card__body">
            <form method="post" action="/eliminations/runs" class="form">
                <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">

                <div class="form-group">
                    <label for="rule_id" class="form-label">Select Rule</label>
                    <select id="rule_id" name="rule_id" class="form-select" required>
                        <option value="">-- Choose Rule --</option>
                        {{ range $rule := .Data.Rules }}
                        <option value="{{ $rule.ID }}">{{ $rule.Name }}</option>
                        {{ end }}
                    </select>
                </div>

                <div class="form-group">
                    <label for="period_id" class="form-label">Select Period</label>
                    <select id="period_id" name="period_id" class="form-select" required>
                        <option value="">-- Choose Period --</option>
                        {{ range $period := .Data.Periods }}
                        <option value="{{ $period.ID }}">{{ $period.Name }} ({{ $period.StartDate.Format "02 Jan" }} -
                            {{ $period.EndDate.Format "02 Jan" }})</option>
                        {{ end }}
                    </select>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn--primary w-full">Initialize Run</button>
                </div>
            </form>
        </div>
    </section>

    <section class="card col-span-1 lg:col-span-2">
        <header class="card__header">
            <h2 class="card__title">Run History</h2>
        </header>
        <div class="table-wrap">
            <table class="table">
                <thead>
                    <tr>
                        <th>Rule</th>
                        <th>Period</th>
                        <th>Status</th>
                        <th class="text-right">Eliminated</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {{ if eq (len .Data.Runs) 0 }}
                    <tr>
                        <td colspan="5" class="text-center text-secondary py-4">No runs recorded.</td>
                    </tr>
                    {{ end }}
                    {{ range $run := .Data.Runs }}
                    <tr>
                        <td class="font-bold">{{ if $run.Rule }}{{ $run.Rule.Name }}{{ else }}Rule #{{ $run.RuleID }}{{
                            end }}</td>
                        <td>{{ $run.PeriodID }}</td>
                        <td>
                            <span class="badge 
                                {{ if eq $run.Status " POSTED" }}badge--success {{ else if eq $run.Status "SIMULATED"
                                }}badge--info {{ else }}badge--neutral{{ end }}">
                                {{ $run.Status }}
                            </span>
                        </td>
                        <td class="text-right font-mono">
                            {{ if $run.Summary }}
                            {{ printf "%.2f" $run.Summary.Eliminated }}
                            {{ else }}
                            -
                            {{ end }}
                        </td>
                        <td class="text-right">
                            <a href="/eliminations/runs/{{ $run.ID }}" class="btn btn--sm btn--secondary">Details</a>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </section>
</div>
{{ end }}

{{ define "pages/eliminations/runs.html" }}
{{ template "layouts/base.html" . }}
{{ end }}
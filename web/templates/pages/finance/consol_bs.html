{{ define "pages/finance/consol_bs.html" }}
{{ template "layouts/base.html" . }}
{{ end }}

{{ define "title" }}Consolidated Balance Sheet{{ end }}

{{ define "content" }}
<header class="page-header">
    <div class="page-header__content">
        <h1>Consolidated Balance Sheet</h1>
        <div class="text-sm text-secondary">
            Group ID {{ .Data.Filters.GroupID }} &mdash; Period {{ .Data.Filters.Period }} &mdash; FX {{ if
            .Data.Filters.FxOn }}On{{ else }}Off{{ end }}
        </div>
    </div>
    <div class="page-header__actions">
        <a href="/finance/consol/bs/export.csv?group={{ .Data.Filters.GroupID }}&period={{ .Data.Filters.Period }}&fx={{ if .Data.Filters.FxOn }}on{{ else }}off{{ end }}"
            class="btn btn--secondary">
            Export CSV
        </a>
        <a href="/finance/consol/bs/pdf?group={{ .Data.Filters.GroupID }}&period={{ .Data.Filters.Period }}&fx={{ if .Data.Filters.FxOn }}on{{ else }}off{{ end }}"
            class="btn btn--secondary">
            Export PDF
        </a>
    </div>
</header>

<section class="card mb-6">
    <form method="get" action="/finance/consol/bs" class="form-row align-end">
        <div class="form-group col">
            <label for="group" class="form-label">Group ID</label>
            <input type="number" id="group" name="group" class="form-input" value="{{ .Data.Filters.GroupID }}" min="1"
                required>
        </div>
        <div class="form-group col">
            <label for="period" class="form-label">Period (YYYY-MM)</label>
            <input type="text" id="period" name="period" class="form-input" value="{{ .Data.Filters.Period }}"
                placeholder="2024-01" required>
        </div>
        <div class="form-group col">
            <label for="fx" class="form-label">FX Policy</label>
            <select id="fx" name="fx" class="form-select">
                <option value="off" {{ if not .Data.Filters.FxOn }}selected{{ end }}>Off</option>
                <option value="on" {{ if .Data.Filters.FxOn }}selected{{ end }}>On</option>
            </select>
        </div>
        <div class="form-group col-auto">
            <button type="submit" class="btn btn--primary">Apply Filters</button>
        </div>
    </form>
    {{ with index .Data.Errors "group" }}<p class="text-error mt-2">{{ . }}</p>{{ end }}
    {{ with index .Data.Errors "period" }}<p class="text-error mt-2">{{ . }}</p>{{ end }}
</section>

{{ with .Data.Warnings }}
<div class="alert alert--warning mb-6">
    <ul class="list-disc pl-4">
        {{ range . }}<li>{{ . }}</li>{{ end }}
    </ul>
</div>
{{ end }}

{{ with index .Data.Errors "general" }}
<div class="alert alert--error mb-6">{{ . }}</div>
{{ end }}

<section class="card mb-6">
    <header class="card__header">
        <h2 class="card__title">Totals</h2>
    </header>
    <div class="card__body">
        <dl class="grid grid-cols-4 gap-4">
            <div>
                <dt class="text-sm text-secondary">Assets</dt>
                <dd class="text-xl font-bold">{{ formatDecimal .Data.Totals.Assets }}</dd>
            </div>
            <div>
                <dt class="text-sm text-secondary">Liabilities + Equity</dt>
                <dd class="text-xl font-bold">{{ formatDecimal .Data.Totals.LiabEquity }}</dd>
            </div>
            <div>
                <dt class="text-sm text-secondary">Balanced</dt>
                <dd class="text-xl font-bold {{ if .Data.Totals.Balanced }}text-success{{ else }}text-error{{ end }}">
                    {{ if .Data.Totals.Balanced }}Yes{{ else }}No{{ end }}
                </dd>
            </div>
            <div>
                <dt class="text-sm text-secondary">Delta FX</dt>
                <dd class="text-xl font-bold">{{ formatDecimal .Data.Totals.DeltaFX }}</dd>
            </div>
        </dl>
    </div>
</section>

<div class="grid grid-cols-2 gap-6 mb-6">
    <section class="card">
        <header class="card__header">
            <h2 class="card__title">Assets</h2>
        </header>
        <div class="table-wrap">
            <table class="table table--compact">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Account</th>
                        <th class="text-right">Local</th>
                        <th class="text-right">Group</th>
                    </tr>
                </thead>
                <tbody>
                    {{ if .Data.Assets }}
                    {{ range .Data.Assets }}
                    <tr>
                        <td>{{ .AccountCode }}</td>
                        <td>{{ .AccountName }}</td>
                        <td class="text-right">{{ formatDecimal .LocalAmount }}</td>
                        <td class="text-right">{{ formatDecimal .GroupAmount }}</td>
                    </tr>
                    {{ end }}
                    {{ else }}
                    <tr>
                        <td colspan="4" class="text-center text-secondary py-4">No data available</td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </section>

    <section class="card">
        <header class="card__header">
            <h2 class="card__title">Liabilities &amp; Equity</h2>
        </header>
        <div class="table-wrap">
            <table class="table table--compact">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Account</th>
                        <th class="text-right">Local</th>
                        <th class="text-right">Group</th>
                    </tr>
                </thead>
                <tbody>
                    {{ if .Data.LiabilitiesEq }}
                    {{ range .Data.LiabilitiesEq }}
                    <tr>
                        <td>{{ .AccountCode }}</td>
                        <td>{{ .AccountName }}</td>
                        <td class="text-right">{{ formatDecimal .LocalAmount }}</td>
                        <td class="text-right">{{ formatDecimal .GroupAmount }}</td>
                    </tr>
                    {{ end }}
                    {{ else }}
                    <tr>
                        <td colspan="4" class="text-center text-secondary py-4">No data available</td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </section>
</div>

<section class="card">
    <header class="card__header">
        <h2 class="card__title">Entity Contribution</h2>
    </header>
    <div class="table-wrap">
        <table class="table">
            <thead>
                <tr>
                    <th>Entity</th>
                    <th class="text-right">Group Amount</th>
                    <th class="text-right">Contribution %</th>
                </tr>
            </thead>
            <tbody>
                {{ if .Data.Contributions }}
                {{ range .Data.Contributions }}
                <tr>
                    <td>{{ .EntityName }}</td>
                    <td class="text-right">{{ formatDecimal .GroupAmount }}</td>
                    <td class="text-right">{{ printf "%.2f" .Percent }}%</td>
                </tr>
                {{ end }}
                {{ else }}
                <tr>
                    <td colspan="3" class="text-center text-secondary py-4">No data available</td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>
</section>
{{ end }}